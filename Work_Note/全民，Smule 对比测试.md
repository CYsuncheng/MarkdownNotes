# 唱吧，全民K歌，Smule 对比测试

## 测试环境
- 设备：三星 S6 Edge
- Android ：6.0.1
- 网络：Kulv 5G
- Package&LaunchActivity：
	- com.tencent.karaoke/.module.splash.ui.SplashBaseActivity
	- com.smule.singandroid/.StartupActivity_
	- com.changba/.splash.Welcome

## APK 包大小
- Smule ：36.7M
- 全民k歌 ：30.2M
- 唱吧 ：42.6M

## 启动时间（ms）
**取值自 am start 命令，冷启动：Kill Process，热启动：Back 退出 App**

1. 三星 S6 Edge （Andriod 6.0）

| 产品 | 首次安装 | 冷启动 | 热启动 |
| :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 623 | 432 | 385 |
| Smule 4.5.1 | 754 | 722 | 739 |
| 全民K歌 3.9.2 | 875 | 571 | 146 |

2. 华为荣耀 7（Android 5.0）

| 产品 | 首次安装 | 冷启动 | 热启动 |
| :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 1106 | 964 | 1159 |
| Smule 4.5.1 | 1613 | 1715 | 305 |
| 全民K歌 3.9.2 | 2549 | 1507 | 264 |

3. Oppo R7 （Android 4.4.4）

- 此机型，首次安装的启动时间，偏差很大，暂无参考意义，忽略

| 产品 | 首次安装 | 冷启动 | 热启动 |
| :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | ~~489~~ | 551 | 726 |
| Smule 4.5.1 | ~~5610~~ | 1069 | 1121 |
| 全民K歌 3.9.2 | ~~923~~ | 1007 | 897 |

4. Vivo Y 51（Android 5.1）

| 产品 | 首次安装 | 冷启动 | 热启动 |
| :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 319 | 287 | 378 |
| Smule 4.5.1 | 881 | 735 | 132 |
| 全民K歌 3.9.2 | 1099 | 767 | 281 |

> am start 命令获得的时间是 Launch Activity 的时间，以唱吧为例，冷启动时间统计的都是 splash.Welcome 的时间
> 但是热启动，有时会统计到包含 AdActivity 的时间，所以，热启动反而时间会比冷启动耗时更多

**由于唱吧的 Welcome Activity 只是显示了一张图片，并没有过多逻辑，所以个人觉得以这个的时间作为结果有些不太合理**
**下面是针对 MainActivity 做测试得出的一组数据**

| 产品 | 首次安装 | 冷启动 | 热启动 |
| :---: | :---: | :---: | :---: |
| 唱吧 8.2.3.1 | 2885 | 2162 | 256 |

## 核心功能耗时（s）
- **测试伴奏：你还要我怎样-薛之谦，时长5:10，不同平台大小不一样，表格已记录**

| 产品 | 伴奏下载时间 | 音频保存时间 | 视频保存时间 | 音频上传时间 | 视频上传时间 | 音频播放loading时间 | 视频播放loading时间 |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 4.76M/22.66 | 30.36 | 38.89 | 6.73（4.75M） | 32.55（28.4M） | 1.87 | 3.57 |
| Smule 4.5.1 | 5M（计算）/9.34 | 2.21 | 3.34 | 1 ~ 2  | 1.39.70 | 3.27 | 7.67 |
| 全民K歌 3.9.2 | 3.1M/24.48 | 12.35 | 24.86 | 4.26（3.59M） | 20.93（23.9M） | 3.67 | 4.65 |

## 核心功能性能指标
- Smule ： CPU 和 MEM 都很稳定
- 全民K歌 ：  MEM 浮动相对较大，表现为开始录制 or 播放时较高，临近结束下降明显
- 唱吧 ：CPU消耗相对较高，内存表现较好，录制有些许浮动，播放时比较稳定

### CPU
- **取值自 top 命令**

| 产品 | 音频录制 | 视频录制 | 音频播放 | 视频播放 | 视频 Mini播放器 |
| :----: | :----: | :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 12 ~ 15% | 14 ~ 18% | 8 ~ 11% | 8 ~ 12% | 6 ~ 8%|
| Smule 4.5.1 | 4 ~ 7% | 8 ~ 11% | 8 ~ 9% | 8 ~ 10% | 8 ~ 10% |
| 全民K歌 3.9.2 | 13 ~ 14% | 14 ~ 15% | 8 ~ 9% | 8 ~ 10% | 4 ~ 6% |

### MEM（M）
- **取值自 dumpsys meminfo 命令，TOTAL = Native Heap + Dalvik Heap, 如浮动较大，则记录区间**

| 产品 | 音频录制 | 视频录制 | 音频播放页 | 视频播放页 | 视频 Mini播放器 |
| :----: | :----: | :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 153.8 ~ 192.2 | 220.1 ~ 237.5 | 206.8 | 226.8 | 184.7 |
| Smule 4.5.1 | 252.5 | 329.5 | 213.4 | 232.6 | 223.2 |
| 全民K歌 3.9.2 | 273.3 ~ 292.1 | 312.1 ~ 361.4 | 219.5 ~ 245.5 | 279.1 ~ 301.9 | 193.6 |


## 其他体验

| 产品 | 音频 Mini播放器切换到播放页 | 视频 Mini播放器切换到播放页 | MV异步上传 | 音频异步上传 |
| :----: | :----: | :----: | :----: | :----: |
| 唱吧 8.2.3.1 | 流畅 | 声音和视频都明显卡顿一下，且会黑屏 | 是 | 否 |
| Smule 4.5.1 | 流畅 | 流畅 | 是 | 是 |
| 全民K歌 3.9.2 | 流畅 | 声音和视频都明显卡顿一下 | 否 | 否 |

## 结论
**通过以上测试数据的对比，个人认为，目前可着重优化的方向是：**
1. 视频，Mini播放器切换到播放页时的卡顿和黑屏问题
2. 视频保存时间
3. 音频保存时间
4. Smule 的伴奏下载时间确实很快，可以研究一下
5. APK 包相对是最大的，可适当优化

> 全民的文件保存路径：
> 本地录音：/sdcard/Android/data/com.tencent.karaoke/files/localSong
> 伴奏：/sdcard/Android/data/com.tencent.karaoke/files/obbligato
> Smule 的文件保存路径，需Root：
> 伴奏&音频&视频：/data/data/com.smule.singandroid/files